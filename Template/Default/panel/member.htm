<import template="/panel/_header" />
<import template="/panel/_content" />
<div class="row">
    <div class="col-sm-3">

        <div class="xe-widget xe-counter" data-count=".num" data-from="0" data-to="99.9" data-suffix="%"
             data-duration="2">
            <div class="xe-icon">
                <i class="fa fa-cloud"></i>
            </div>
            <div class="xe-label">
                <strong class="num">99.9%</strong>
                <span>服务在线率</span>
            </div>
        </div>

        <div class="xe-widget xe-counter xe-counter-purple" data-count=".num">
            <div class="xe-icon">
                <i class="fa-calendar"></i>
            </div>
            <div class="xe-label">
                <!-- reset -->

                <div id="checkin-on" <if condition="!$checked">style="display:none;"</if> >
                <strong>
                    <a id="checkin" href="javascript:;" style="color:#000;">点击签到</a>
                </strong>
                <span id="checkin-tag">签到送流量</span>
            </div>
            <div id="checkin-off" <if condition="$checked">style="display:none;"</if> >
            <strong>
                <div id="checkinoff">您已签到</div>
            </strong>
            <span id="checkinoff-tag">{$checkedTime}</span>
        </div>
    </div>
</div>

<div class="xe-widget xe-counter xe-counter-info" data-count=".num" data-from="1" data-to="{$allNode}" data-duration="1"
     data-easing="true">
    <div class="xe-icon">
        <i class="fa fa-server"></i>
    </div>
    <div class="xe-label">
        <strong class="num">{$allNode}</strong>
        <span>共有节点</span>
    </div>
</div>

</div>
<div class="col-sm-6">

    <div class="chart-item-bg">
        <div class="chart-label">
            <div class="h3 text-secondary text-bold" data-count="this" data-from="0" data-to="{$useTransfer}" data-suffix="{$useTransferUnit}" data-duration="1">{$useTransfer} {$useTransferUnit}</div>
            <span class="text-medium text-muted">流量使用情况</span>
        </div>
        <div class="progress progress-striped active" style="height: 20px;position: absolute;left:30px;right:30px;top:30%">
            <div class="progress-bar progress-bar-info" style="width: {$pctTransfer}%;height:20px;"></div>
        </div>
        <div style="position: absolute;left:30px;right:30px;top:40%">共有流量：{$allTransfer}<br/>可用流量：{$slaTransfer}<br/><br/>您的当前IP：<code>{$userIp}</code><br/>
            <h2><a href="/wiki" target="_blank"><span style="color:#c7254e;font-weight:bold;">使用教程&gt;&gt;</span></a></h2>
        </div>
        <div  style="height: 298px;">

        </div>
    </div>
</div>
<!--
<div class="col-sm-3">
    <div class="chart-item-bg">
        <div class="chart-label chart-label-small">
            <div class="h4 text-secondary text-bold" data-count="this" data-duration="1.5">高级会员</div>
            <span class="text-small text-upper text-muted">10元每月50GB</span><br />
            <a href="{$buySeniorMember}" target="_blank"><span class="text-mid text-red text-upper text-muted">购买</span></a>
        </div>
        <div style="height: 82px;"></div>
    </div>
    <div class="chart-item-bg">
        <div class="chart-label chart-label-small">
            <div class="h4 text-yellow text-bold" data-count="this" data-duration="1.5">超级会员</div>
            <span class="text-small text-upper text-muted">25元每月200GB</span><br />
            <a href="{$buySuperMember}" target="_blank"><span class="text-mid text-red text-upper text-muted">购买</span></a>
        </div>
        <div style="height: 82px;"></div>
    </div>
    <div class="chart-item-bg">
        <div class="chart-label chart-label-small">
            <div class="h4 text-purple text-bold" data-count="this" data-duration="1.5">固定流量</div>
            <span class="text-small text-upper text-muted">10元永久20GB</span><br />
            <a href="{$buyFixedTransfer}" target="_blank"><span class="text-mid text-red text-upper text-muted">购买</span></a>
        </div>
        <div style="height: 82px;"></div>
    </div>
</div>-->
</div>


<div class="row">
    <div class="col-sm-6">

        <div class="chart-item-bg">
            <div class="chart-entry-view">
                <div class="chart-entry-label">
                    <if condition="count($globalMessage)>0">
                        <span>{$globalMessage[1]->content}</span><br/>
                    </if>
                    <!-- 管理员自行修改下载地址和内容 -->
                    <p>Win客户端：1.<a href="http://wukongss.com/down/shadowsocks-win-2.3.1.zip" target="_blank">shadowsocks-win</a>&nbsp;&nbsp;&nbsp;
                        2.<a href="https://github.com/shadowsocks/shadowsocks-windows/releases/latest" target="_blank">Github</a>
                        <br>Android客户端：1.<a href="http://wukongss.com/down/shadowsocks-nightly-3.2.8.apk" target="_blank">SS-Android_3.2.8.apk</a>&nbsp;&nbsp;&nbsp;
                        2.<a href="https://play.google.com/store/apps/details?id=com.github.shadowsocks" target="_blank">Play Store</a></p>
                    Mac客户端<a href="http://wukongss.com/down/ShadowsocksX-2.6.3.dmg" target="_blank">Mac下载</a>
                    <br>微信公众号(集查询,抽奖,购买于一身的贴心服务):
                    <br><img width="180" height="180" src="../{RESOURCE}/images/wukongss.jpg">
                </div>
            </div>
        </div>

    </div>
    <div class="col-sm-6">

        <div class="chart-item-bg">
            <div class="chart-label">
                <div  class="h1 text-purple text-bold">连接信息</div>
                端口：<code>{$user->port}</code><br />
                密码：<div id="showpwd" style="display: inline"><b>{$user->sspwd}</b></div><br />
                加密方式：<code>chacha20</code><br />
                服务器地址：<code><a href="/member/node">点击查看</a></code><br />
                <button class="btn btn-sm btn-info" id="plan-level">{$user->getPlan()}</button>   &nbsp;
                <button class="btn btn-sm btn-secondary" id="updatePlan"> 升级套餐 </button>   &nbsp;
                <button class="btn btn-sm btn-secondary" id="planList"> 套餐详情 </button><br /><br />
                最后使用时间：<code>{$lastOnlineTime}</code>

            </div>
            <div style="height: 200px"></div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        <php>
            $user_json = json_decode($user->forgePwdCode, true);
            if($user_json['verification']!=null && $user->enable == 0) {
                echo "showToastr(\"您的账户尚未校验邮箱，暂时无法使用本站服务，请校验后重新登陆。\", 0);";
            }
        </php>
        $("#checkin").click(function() {
            var chkin = $(this);
            chkin.text("请稍等");
            showToastr("正在请求签到..请稍等", 0, 1500);
            var checkInUrl = chkin.attr("href");
            chkin.removeAttr("href").addClass("disabled");
            $.ajax({
                type:"GET",
                url:"/member/checkIn.json",
                dataType:"json",
                success:function(result) {
                    chkin.text("点击签到");
                    if(result.code != 200) {
                        chkin.removeClass("disabled").attr("href", checkInUrl);
                        showToastr(result.message, 0, 3000, '系统错误');
                        return;
                    }
                    if(result.data.error == 0) {
                        $("#checkin-on").hide();
                        $("#checkin-off").show();
                        $("#checkinoff-tag").html(result.data.time);
                    }
                    showToastr(result.data.message, 0);
                },
                error:function(jqXHR) {
                    chkin.removeClass("disabled").attr("href", checkInUrl);
                    showToastr("出现未知错误，请重试或联系管理员", 0);
                }
            });
        });
        $("#updatePlan").on('click', function(){
            var btn = $(this);
            btn.html("请稍等");
            btn.attr('disabled', 'true').addClass("disabled");
            $.ajax({
                type:"GET",
                url:"/member/updatePlan.json",
                dataType:"json",
                success:function(result) {
                    btn.removeAttr('disabled').removeClass("disabled").html("升级套餐");
                    if(result.code != 200) {
                        showToastr(result.message, 0, 3000, '系统错误');
                        return;
                    }
                    if(result.data.error == 0) {
                        $("#plan-level").html(result.data.level);
                    }
                    showToastr(result.data.message, 0);
                },
                error:function(jqXHR) {
                    btn.removeAttr('disabled').removeClass("disabled").html("升级套餐");
                    showToastr("发生错误：" + jqXHR.status, 0);
                }
            });
        });
        $("#showpwd").on('click', function() {
            if ($(this).html() == "<b>点击显示密码</b>") {
                $(this).html("{$user->sspwd}");
            } else {
                $(this).html("<b>点击显示密码</b>");
            }
        });
        <if condition="$globalMessage[3]!=null && $globalMessage[3]->enable==1">
            showToastr("{$globalMessage[3]->content}", 800);
        </if>

        $("#planList").on('click', function(){
            <if condition="$globalMessage[2]!=null && $globalMessage[2]->enable==1">
                $("#modal-1 .modal-body").html("{$globalMessage[2]->content}");
            <else>
                $("#modal-1 .modal-body").html("管理员未设置内容..");
            </if>

            $("#modal-1").modal("show", {backdrop:"fade"});
        });
    });
</script>
<import template="/panel/_footer" />